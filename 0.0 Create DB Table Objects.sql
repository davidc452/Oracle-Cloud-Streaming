--basic proof of concept setup requirements

--manages last OCI offset position.

CREATE TABLE "ADMIN"."STREAM_CONSUME_OFFSET_POSITION" 
   (	"LAST_OFFSET" NUMBER(18,0)
   )  DEFAULT COLLATION "USING_NLS_COMP" ;

ALTER TABLE "ADMIN"."STREAM_CONSUME_OFFSET_POSITION" MODIFY ("LAST_OFFSET" NOT NULL ENABLE);

--maintains Point of Service Client transactions to be replicated to OCI Stream
CREATE TABLE "ADMIN"."POS_DATA_CLIENT" 
   (	"RECEIPT_ID" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"ZIP_CODE" NUMBER(38,0), 
	"LOCATION" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"LAST_NAME" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"POS_ID" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"CATEGORY" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"SUBCATEGORY" VARCHAR2(60 BYTE) COLLATE "USING_NLS_COMP", 
	"QUANTITY" NUMBER(38,0), 
	"SALES" NUMBER(38,2), 
	"POS_DATE" DATE, 
	"HOUR_OF_DAY" NUMBER(38,0), 
	"RETAIL_PRICE" VARCHAR2(10 BYTE) COLLATE "USING_NLS_COMP", 
	"FIPS" VARCHAR2(25 BYTE) COLLATE "USING_NLS_COMP", 
	"PRODUCT_ID" VARCHAR2(60 BYTE) COLLATE "USING_NLS_COMP", 
	"REGISTER_ID" NUMBER, 
	"REWARD_ID" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"PROMO_ID" NUMBER, 
	"COUPON_ID" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"POS_LN_ID" NUMBER
   )  DEFAULT COLLATION "USING_NLS_COMP" ;

--Target.  Stream messages are read from OCI Topic and inserted

CREATE TABLE "ADMIN"."STREAM_POS_DATA" 
   (	"TRAN_ID" NUMBER(38,0) GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"CREATED_ON" TIMESTAMP (9), 
	"LOCATION" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"HOUR_OF_DAY" NUMBER(38,0), 
	"REGISTER_ID" NUMBER(10,0), 
	"POS_DATE" DATE, 
	"POS_ID" NUMBER(20,0), 
	"POS_LN_ID" NUMBER(10,0), 
	"UNITS" NUMBER(10,0), 
	"SALES_PRICE" NUMBER(20,2), 
	"RETAIL_PRICE" NUMBER(20,2), 
	"REWARD_ID" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"PROMO_ID" VARCHAR2(26 BYTE) COLLATE "USING_NLS_COMP", 
	"COUPON_ID" VARCHAR2(60 BYTE) COLLATE "USING_NLS_COMP", 
	"ZIP_CODE" NUMBER(38,0), 
	"FIPS" VARCHAR2(25 BYTE) COLLATE "USING_NLS_COMP", 
	"PRODUCT_ID" VARCHAR2(60 BYTE) COLLATE "USING_NLS_COMP"
   )  DEFAULT COLLATION "USING_NLS_COMP" ;

ALTER TABLE "ADMIN"."STREAM_POS_DATA" MODIFY ("TRAN_ID" NOT NULL ENABLE);

GRANT SELECT ON "ADMIN"."STREAM_POS_DATA" TO "RETAIL";

-- Logging File

CREATE TABLE "ADMIN"."ERROR_LOGGING" 
   (	"ERROR_OFFSET_ID" VARCHAR2(20 BYTE) COLLATE "USING_NLS_COMP", 
	"ERROR_MESSAGE" CLOB COLLATE "USING_NLS_COMP"
   )  DEFAULT COLLATION "USING_NLS_COMP" ;

ALTER TABLE "ADMIN"."ERROR_LOGGING" MODIFY ("ERROR_OFFSET_ID" NOT NULL ENABLE NOVALIDATE);